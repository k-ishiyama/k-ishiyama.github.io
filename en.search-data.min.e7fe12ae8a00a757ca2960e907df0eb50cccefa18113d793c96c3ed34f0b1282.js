'use strict';(function(){const indexCfg={cache:true};indexCfg.doc={id:'id',field:['title','content'],store:['title','href','section'],};const index=FlexSearch.create('balance',indexCfg);window.bookSearchIndex=index;index.add({'id':0,'href':'/docs/physics/','title':"Physics",'section':"Docs",'content':"物理に関する話題をまとめる.\n"});index.add({'id':1,'href':'/docs/physics/analytical_mechanics/','title':"Analytical Mechanics",'section':"Physics",'content':"Analytical Mechanics #  Hamilton\u0026rsquo;s Principle #  \\(N\\)次元ユークリッド空間を考えて, 時間を \\(t\\), 座標を \\(\\bm{q}(t)=\\begin{pmatrix}q_1(t) \\\\ q_2(t) \\\\ \\vdots \\\\ q_N(t)\\end{pmatrix}\\) と書く.\nそして, 時間による微分を\t\\(\\dot{\\bm{q}}:=\\frac{d\\bm{q}}{dt}\\) と略記する.\n空間中にラグランジアン \\(L(\\bm{q},\\dot{\\bm{q}},t)\\) なる量を考え, 曲線 \\(\\bm{q}(t)\\) に沿った線積分   \\[\tS[\\bm{q}] = \\int^b_aL(\\bm{q},\\dot{\\bm{q}},t)dt \\tag{hp.1}\\]  を作用と呼ぶ.\n作用は \\(\\bm{q}(t)\\) を引数とする汎関数になっている. 作用が停留点をとる経路上では, その変分 \\(\\delta S\\) が 0 になる  \\[\t\\delta S[\\bm{q}] = 0. \\tag{hp.2}\\]  この式 (hp.2) を Hamilton の原理と呼ぶ.\nこのような経路は, 力学では質点の運動の軌跡, 幾何光学では光線の軌跡, 幾何音響学では音響エネルギーの軌跡に対応する. この原理の元に構築される解析力学の手法は, 各分野に共通して用いることができる.\nEuler-Lagrange Equation #  作用 \\(S\\) について, 始点 \\(\\bm{q}(a)\\) と終点 \\(\\bm{q}(b)\\) を固定し, \\(S\\) が停留値をとる \\(\\bm{q}(t)\\) を求めるとする. そのような \\(\\bm{q}\\) に対する条件は, Euler-Lagrange 方程式  \\[\t\\frac{\\partial L}{\\partial\\bm{q}} - \\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial\\dot{\\bm{q}}}\\right) = 0 \\tag{el.1}\\]  で与えられる.\nHamilton\u0026rsquo;s Equations #  運動量を  \\[\t\\bm{p} := \\frac{\\partial L}{\\partial\\dot{\\bm{q}}} \\tag{he.1}\\]  と定義し, Legendre 変換  \\[\tH(\\bm{q},\\bm{p},t) := \\bm{p}\\cdot\\dot{\\bm{q}} - L(\\bm{q},\\dot{\\bm{q}},t) \\tag{he.2}\\]  によって, 変数 \\(\\dot{\\bm{q}}\\) を \\(\\bm{p}\\) へ変換する. ここで導入した \\(H(\\bm{q},\\bm{p},t)\\) を Hamiltonian という.\nこれにより, 作用が停留値をとる条件は  \\[\t\\dot{\\bm{q}} = \\frac{\\partial H}{\\partial\\bm{p}},\\quad \\dot{\\bm{p}} = -\\frac{\\partial H}{\\partial\\bm{q}} \\tag{he.3}\\]  となる. これを Hamilton の運動方程式という.\n質点の座標 \\(\\bm{q}\\) を持つ空間を配位空間, 座標と運動量 \\((\\bm{q},\\bm{p})\\) を持つ空間を相空間と呼ぶ.\nHamilton\u0026ndash;­Jacobi Equation #  作用 \\(S\\) について, 始点 \\(\\bm{q}(a)\\) を固定し, 終点 \\(\\bm{q}(t)\\) を自由に動かすとする. このとき, 停留値を取る \\(\\bm{q}(t)\\) を与える \\(S(\\bm{q},t)\\) について, Hamilton-Jacobi 方程式  \\[\t-\\frac{\\partial S}{\\partial t} = H\\left(\\bm{q},\\frac{\\partial S}{\\partial q},t\\right)\\]  が成り立つ.\nCanonical Transformation #  変数変換 \\( (\\bm{q},\\bm{p})\\rightarrow(\\bm{Q},\\bm{P}) \\) を考える.  \\[\t\\bm{q}\\rightarrow \\bm{Q}(\\bm{q},\\bm{p},t),\\quad \\bm{p}\\rightarrow \\bm{P}(\\bm{q},\\bm{p},t) \\tag{ct.1}\\]  この変換に伴って変化した Hamiltonian を \\(K(\\bm{Q},\\bm{P},t)\\) と書き, 新しい変数 \\((\\bm{Q},\\bm{P})\\) についても Hamilton の運動方程式 (he.3)  \\[\t\\dot{\\bm{Q}} = \\frac{\\partial K}{\\partial\\bm{P}},\\quad \\dot{\\bm{P}} = -\\frac{\\partial K}{\\partial\\bm{Q}} \\tag{ct.2}\\]  が成り立つとき, 変数変換 \\((\\bm{q},\\bm{p})\\rightarrow(\\bm{Q},\\bm{P})\\) を正準変換と呼ぶ.\n正準変換は, Hamilton の原理 (hp.2) から導かれるから,  \\[\t\\int^b_a\\left(\\bm{p}\\cdot\\dot{\\bm{q}}-H(\\bm{p},\\bm{q})\\right)dt = \\int^b_a\\left(\\bm{P}\\cdot\\dot{\\bm{Q}} - K(\\bm{Q},\\bm{P}) \u0026#43; \\frac{dG(\\bm{q},\\bm{p},\\bm{Q},\\bm{P},t)}{dt}\\right)dt \\tag{ct.3}\\]  より  \\[\t\\bm{p}\\cdot\\dot{\\bm{q}}-H(\\bm{p},\\bm{q}) = \\bm{P}\\cdot\\dot{\\bm{Q}} - K(\\bm{Q},\\bm{P}) \u0026#43; \\frac{dG(\\bm{q},\\bm{p},\\bm{Q},\\bm{P},t)}{dt} \\tag{ct.4}\\]  が成り立つ必要がある. ここで, \\(\\bm{p}\\cdot\\dot{\\bm{q}}\\) が \\(\\bm{P}\\cdot\\dot{\\bm{Q}}\\) に変化したぶんの補正で, ハミルトニアンの変化のほかに任意関数 \\(G(\\bm{q},\\bm{p},\\bm{Q},\\bm{P},t)\\) で表されるとした.\nGenerating Function #  式(ct.3)で導入した任意関数 \\( G \\) の \\(4N\\) 個の引数 \\( \\bm{q},\\bm{p},\\bm{Q},\\bm{P} \\) のうち, 独立な変数は \\( 2N \\) 個となっている. 従って, その独立変数の選び方には \\( (\\bm{q},\\bm{Q}),(\\bm{q},\\bm{P}),(\\bm{p},\\bm{Q}),(\\bm{p},\\bm{P}) \\) の4通りがある.\nはじめに \\( (\\bm{q},\\bm{Q}) \\) を考える. この場合の \\(G\\) を \\(G=G_1(\\bm{q},\\bm{Q},t)\\) と書く. \\(G_1\\)の全微分を取ると,  \\[\t\\frac{dG_1(\\bm{q},\\bm{Q},t)}{dt} = \\frac{\\partial G_1}{\\partial\\bm{q}}\\cdot\\dot\\bm{q} \u0026#43; \\frac{\\partial G_1}{\\partial\\bm{Q}}\\cdot\\dot\\bm{Q} \u0026#43; \\frac{\\partial G_1}{\\partial t}\\]  となる. これを式 (ct.4) へ代入すると,  \\[\t\\bm{p}\\cdot\\dot{\\bm{q}} - \\bm{P}\\cdot\\dot{\\bm{Q}} \u0026#43; (K - H) = \\frac{\\partial G_1}{\\partial\\bm{q}}\\cdot\\dot\\bm{q} \u0026#43; \\frac{\\partial G_1}{\\partial\\bm{Q}}\\cdot\\dot\\bm{Q} \u0026#43; \\frac{\\partial G_1}{\\partial t}\\]  となる. 両辺の各項を比較すれば,  \\[\t\\bm{p} = \\frac{\\partial G_1(\\bm{q},\\bm{Q},t)}{\\partial\\bm{q}},\\quad \\bm{P} = -\\frac{\\partial G_1(\\bm{q},\\bm{Q},t)}{\\partial\\bm{Q}},\\quad K = H \u0026#43; \\frac{\\partial G_1(\\bm{q},\\bm{Q},t)}{\\partial t}\\]  が得られる. 任意関数 \\(G_1\\) は, \\(\\bm{q},\\bm{Q}\\) を引数として \\(\\bm{p},\\bm{P}\\) を生成することから, 生成母関数とよぶ.\nそのほか, \\((\\bm{q},\\bm{P}),(\\bm{p},\\bm{Q}),(\\bm{p},\\bm{P})\\) についても, Legendre 変換によって変数変換を繰り返すことで, 同様の関係を得ることができる. これをまとめると, 下記の表となる.\n   Generating function Dependent variables New Hamiltonian     \\(G = G_1(\\bm{q},\\bm{Q},t)\\) \\(\\bm{p}=\\frac{\\partial G_1}{\\partial\\bm{q}},\\; \\bm{P} = -\\frac{\\partial G_1}{\\partial\\bm{Q}}\\) \\(K = H + \\frac{\\partial G_1}{\\partial t}\\)   \\(G = -\\bm{P}\\cdot\\bm{Q}+G_2(\\bm{q},\\bm{P},t)\\) \\(\\bm{p}=\\frac{\\partial G_2}{\\partial\\bm{q}},\\; \\bm{Q} = -\\frac{\\partial G_2}{\\partial\\bm{P}}\\) \\(K = H + \\frac{\\partial G_2}{\\partial t}\\)   \\(G = \\bm{p}\\cdot\\bm{q}+G_3(\\bm{q},\\bm{P},t)\\) \\(\\bm{q}=-\\frac{\\partial G_3}{\\partial\\bm{p}},\\; \\bm{P} = -\\frac{\\partial G_3}{\\partial\\bm{Q}}\\) \\(K = H + \\frac{\\partial G_3}{\\partial t}\\)   \\(G = \\bm{p}\\cdot\\bm{q}-\\bm{P}\\cdot\\bm{Q}+G_4(\\bm{q},\\bm{P},t)\\) \\(\\bm{q}=-\\frac{\\partial G_4}{\\partial\\bm{p}},\\; \\bm{Q} = \\frac{\\partial G_4}{\\partial\\bm{P}}\\) \\(K = H + \\frac{\\partial G_4}{\\partial t}\\)    Symplectic Approach #  \\(2N\\) ベクトル \\(\\bm{\\eta}:=\\begin{pmatrix}\\bm{q} \\\\ \\bm{p}\\end{pmatrix}\\) と, \\(2N\\times 2N\\) 行列 \\(\\Omega\\),  \\[\t\\Omega:= \\begin{pmatrix} 0\t\u0026amp; \\bm{1} \\\\ -\\bm{1} \u0026amp; 0 \\end{pmatrix}\\]  を使って, Hamilton の運動方程式 (he.3) を  \\[\t\\dot{\\bm{\\eta}} = \\Omega\\frac{\\partial H}{\\partial\\bm{\\eta}}\\]  と書く. また, 正準変換 (ct.1) も \\(\\bm{\\xi}(\\bm{\\eta}):=\\begin{pmatrix}\\bm{Q} \\\\ \\bm{P}\\end{pmatrix}\\) とまとめて書くと, その時間微分は\n \\[\t\\dot{\\bm{\\xi}} = M\\dot{\\bm{\\eta}},\\quad M := \\frac{\\partial\\bm{\\xi}}{\\partial\\bm{\\eta}}\\]  と表される. ただし \\(M\\) は変数変換のヤコビアン.\n \\[\t\\dot{\\bm{\\xi}} = M\\Omega\\frac{\\partial H}{\\partial\\bm{\\eta}} = M\\Omega\\frac{\\partial H}{\\partial\\bm{\\xi}}\\frac{\\partial\\bm{\\xi}}{\\partial\\bm{\\eta}} = M\\Omega M^T\\frac{\\partial H}{\\partial\\bm{\\xi}}\\]  従って  \\[\tM\\Omega M^T = \\Omega\\]  が正準変換の条件になる. この条件を Symplectic 関係式, \\(M\\)を Symplectic 行列と呼ぶ.\nIdentical Transformation #  生成母関数を \\(G_2(\\bm{q},\\bm{P},t)=\\bm{q}\\cdot\\bm{P}\\) ととると,  \\[\t\\bm{p}=\\frac{\\partial G_2}{\\partial\\bm{q}}=\\bm{P},\\quad \\bm{Q} = -\\frac{\\partial G_2}{\\partial\\bm{P}}=\\bm{q},\\quad K = H \\tag{it.1}\\]  となる. これは正準変換で何も変わらない. これを恒等変換という.\nInfinitesimal Canonical Transformation #  無限小の量を \\(\\epsilon\\) と書き, 恒等変換から \\(\\epsilon G(\\bm{q},\\bm{P})\\) だけずれた変換を考える.  \\[\tG_2(\\bm{q},\\bm{P},t)=\\bm{q}\\cdot\\bm{P}\u0026#43;\\epsilon G(\\bm{q},\\bm{P})\\]  (it.1)式より  \\[\\begin{aligned} \\bm{Q} \u0026amp;= \\bm{q} \u0026#43; \\epsilon\\frac{\\partial G(\\bm{q},\\bm{P})}{\\partial\\bm{P}}\\\\ \\bm{P} \u0026amp;= \\bm{p} - \\epsilon\\frac{\\partial G(\\bm{q},\\bm{P})}{\\partial\\bm{q}} \\end{aligned} \\tag{ic.1}\\]  これが正準変換になっているかどうかを確かめる. 上式をまとめて書くと  \\[\t\\bm{\\xi} = \\bm{\\eta} \u0026#43; \\epsilon \\Omega\\frac{\\partial G}{\\partial\\bm{\\eta}}\\]  これが Symplectic 関係式を満たすかどうかを調べる. Symplectic行列 \\(M\\) は  \\[\\begin{aligned} M \u0026amp;= \\frac{\\partial\\bm{\\xi}}{\\partial\\bm{\\eta}} = \\bm{1} \u0026#43; \\epsilon\\Omega\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\\\ M^T \u0026amp;= \\bm{1} - \\epsilon\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\Omega \\end{aligned}\\]  となる. これにより, Symplectic 関係式は  \\[\\begin{aligned} M\\Omega M^T \u0026amp;= \\left(\\bm{1} \u0026#43; \\epsilon\\Omega\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\right) \\Omega \\left(\\bm{1} - \\epsilon\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\Omega\\right)\\\\ \u0026amp;= \\Omega \u0026#43; \\epsilon\\Omega\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\Omega - \\epsilon\\Omega\\frac{\\partial^2G}{\\partial\\bm{\\eta}\\partial\\bm{\\eta}}\\Omega\\\\ \u0026amp;= \\Omega \\end{aligned}\\]  となる. 従って, 無限小変換 (ic.1) は正準変換であることがわかる.\nTime Evolution #  時間 \\(t\\) に \\((\\bm{q}(t), \\bm{p}(t))\\) であった状態が, \\(dt\\) だけ経過したのち \\((\\bm{q}(t+dt), \\bm{p}(t+dt))\\) になったとする.  \\[\\begin{aligned} \\bm{Q}(t) \u0026amp;:= \\bm{q}(t\u0026#43;dt) = \\bm{q}(t) \u0026#43; \\dot{\\bm{q}}(t)dt\\\\ \\bm{P}(t) \u0026amp;:= \\bm{p}(t\u0026#43;dt) = \\bm{p}(t) \u0026#43; \\dot{\\bm{p}}(t)dt \\end{aligned}\\]  \\(\\dot{\\bm{q}}, \\dot{\\bm{p}}\\) にHamilton の運動方程式を適用すると  \\[\\begin{aligned} \\bm{Q}(t) \u0026amp;= \\bm{q}(t) \u0026#43; \\frac{\\partial H}{\\partial\\bm{p}}dt\\\\ \\bm{P}(t) \u0026amp;= \\bm{p}(t) - \\frac{\\partial H}{\\partial\\bm{q}}dt \\end{aligned}\\]   無限小正準変換 で考察した内容から, 時間発展は正準変換であり, その生成子は Hamiltonian であることがわかる.\nLiouville Theorem #  正準変換 \\((\\bm{q},\\bm{p})\\rightarrow(\\bm{Q},\\bm{P})\\) による変数変換は  \\[\t\\int d\\bm{Q}d\\bm{P} = \\int|\\det M|d\\bm{q}d\\bm{p}\\]  と書ける.\nSymplectic関係式の行列式をとると  \\[\t(\\det M)^2\\det\\Omega = \\det\\Omega\\]  だから, \\(|M|=\\pm 1\\) となる.\n従って, 正準変換で相空間の体積要素 \\(d\\bm{q}d\\bm{p}\\) は変化しない. これを Liouville の定理という.\n"});index.add({'id':2,'href':'/docs/physics/geometrical_optics/','title':"Geometrical Optics",'section':"Physics",'content':"Geometrical Optics #  Ray of Light #  細く絞った光のビームを考え, その光が通った経路を光線と呼ぶ.\nIndex of Refraction #  光は, 真空中では速さ \\(c\\;[\\text{m}/\\text{s}]\\) で空間を伝搬する. そして, 物質中を伝わる光の速さ \\(v\\;[\\text{m}/\\text{s}]\\) は真空中よりも遅くなる. この速度の比   \\[\tn = \\frac{c}{v}\\quad\\;[-]\\]  を屈折率と呼ぶ.\nOptical Path Length #  時間 \\(t\\;[\\text{s}]\\) のあいだに光が真空中を進む距離は \\(ct\\;[\\text{m}]\\), 屈折率 \\(n\\) の媒質中を進む距離は \\(vt\\;[\\text{m}]\\) となる. このとき, 媒質中を進む距離に屈折率を掛け, 真空中を進む距離に換算した量 \\(nvt\\;[\\text{m}]\\) を光路長と呼ぶ.\n光が進む媒質が不均質で, 場所によって屈折率 \\(n(\\bm{r})\\)が異なるときは, 光路長は次のように書ける.\n光線の経路を3次元空間中の曲線として \\(\\bm{r}(t)=\\begin{pmatrix}x(t)\\\\y(t)\\\\z(t)\\end{pmatrix},\\;(a\\leq t\\leq b)\\) とし, その位置の屈折率を \\(n(\\bm{r})\\) と書く. このとき, 光路長 \\(S\\) は  \\[\tS = \\int^b_a n(\\bm{r})\\left|\\frac{d\\bm{r}}{dt}\\right|dt\\]  と計算できる.\nFermat\u0026rsquo;s Principle #  光線は, 光路長 \\(S\\) が停留値  \\[\t\\delta S[\\bm{r}(t)] = 0\\]  となる経路 \\(\\bm{r}(t)\\)を進行する. これは, フェルマーの原理と呼ばれている ( Born and Wolf, 1999, 山本, 2014).\nHamilton\u0026rsquo;s Principle #  パラメータ \\(t\\) を \\(z\\)軸にとり, 光線の経路 \\(\\bm{r}\\) を  \\[\t\\bm{r}(t)=\\begin{pmatrix}\\bm{q}(t) \\\\ t\\end{pmatrix},\\quad \\bm{q}(t)=\\begin{pmatrix}x(t) \\\\ y(t)\\end{pmatrix}\\]  と表す. ここで, \\(t\\) による微分を \\(\\dot{\\bm{q}} = \\frac{d\\bm{q}}{dt}\\) と略記した.\nこのとき, 光路長は  \\[\tS[\\bm{q},t] = \\int^b_aL(\\bm{q},\\dot{\\bm{q}},t)dt,\\quad L(\\bm{q},\\dot{\\bm{q}},t) = n(\\bm{q},t)|\\dot{\\bm{r}}|\\]  となり, フェルマーの原理 は  \\[\t\\delta S[\\bm{q},t] = 0\\]  と表せる. これは, 配位空間を2次元とする Hamiltonの原理に等しい.\n"});index.add({'id':3,'href':'/docs/physics/particle_mechanics/','title':"Particle Mechanics",'section':"Physics",'content':"Particle Mechanics #  Position and Velocity #  時間を \\(t\\), 3次元ユークリッド空間上の座標を \\(\\bm{q}(t)=\\begin{pmatrix}q_1(t) \\\\ q_2(t) \\\\ \\vdots \\\\ q_N(t)\\end{pmatrix}\\) と書く.\n時間についての微分を, 関数の頭にドットをつけて \\(\\dot{\\bm{r}}(t):=\\frac{d\\bm{r}(t)}{dt}\\) を略記する.\n座標を時間で微分したものを速度 \\(\\bm{v}:=\\dot{\\bm{r}}\\), 速度を時間で微分したものを加速度 \\(\\bm{a}:=\\dot{\\bm{v}}\\) とよぶ.\nNewton\u0026rsquo;s Law of Motion #  空間に点粒子を考え, その位置を \\(\\bm{r}(t)\\) とする. 粒子に加速度を与えるものを力 \\(\\bm{F}\\), 点粒子が力に影響される割合を質量 \\(m\\) とし, 質量を持った点粒子を質点と呼ぶ.\n加速度と力の関係は, ニュートンの運動方程式 (の第2法則)   \\[\t\\bm{F}=m{\\bm{a}} \\tag{nl.1}\\]  によって決まる. これにより, 質点の運動が決まる.\nこのようにモデル化する対象を力学系と呼び, 力学系の位置や速度の時間発展を運動と呼ぶ.\nHamilton\u0026rsquo;s Principle #  ニュートンの運動方程式 (nl.1) を一般化することで, 運動は作用  \\[\tS[\\bm{q}(t)] = \\int^{b}_{a}L(\\bm{q},\\dot{\\bm{q}},t)dt \\tag{hp.1}\\]  が停留点  \\[\t\\delta S[\\bm{q}(t)] = 0 \\tag{hp.2}\\]  をとる軌跡 \\(\\bm{q}(t)\\) を求める, 変分問題に帰着する. 式 (hp.2) を Hamilton の原理という.\nただし,  \\[\tL(\\bm{q},\\dot{\\bm{q}},t) = K(\\bm{q},\\dot{\\bm{q}},t) - V(\\bm{q},\\dot{\\bm{q}},t)\\]  はラグランジアン. \\(K(\\bm{q}(t),\\dot{\\bm{q}}(t),t)\\) は 力学系の運動エネルギー, \\(V(\\bm{q}(t),\\dot{\\bm{q}}(t),t)\\)はポテンシャルエネルギー.\n詳しくは, Hamiltonの原理 に記述する.\n"});index.add({'id':4,'href':'/docs/physics/references/','title':"References",'section':"Physics",'content':"References #  砂川, 重信. (1977). 散乱の量子論. 岩波書店. #  Born, M and Wolf, E. (1999). Principles of Optics (7th Ed.). Cambridge University Press, 7th ed. #  Goldstein, H., Poole, C., and Safko, J. (2002). Classical Mechanics. Addison Wesley, 3rd ed. #  Tong, D. (2005). Lectures on Classical Dynamics. https://www.damtp.cam.ac.uk/user/tong/dynamics.html. #  山本, 義隆. (2014). 幾何光学の正準理論. 数学書房. #  "});index.add({'id':5,'href':'/posts/202012_advent_calendar/','title':"散乱理論とレンダリング方程式",'section':"Blog",'content':"これは レイトレ Advent Calendar 2020 の記事です。\nはじめに #  散乱理論 [ 砂川 1977] では, 散乱現象を微分散乱断面積 \\(\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\;[\\text{m}^2\\,\\text{sr}^{-1}]\\)\n  Fig. 微分散乱断面積 \\(\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\;[\\text{m}^2\\,\\text{sr}^{-1}]\\)\n   で表現します. この概念は, Rendering 方程式にある BRDF \\(f(\\bm{i},\\bm{o})\\;[\\text{sr}^{-1}]\\) とよく似ています.\n微分散乱断面積は, レイリー散乱や, 剛体球に弾かれる粒子の散乱など, 様々な散乱現象を求めるのに使われます. これと BRDF との対応関係がわかれば, 散乱理論で培われた知見を, さまざまな BRDF の考察に応用することができるかもしれません.\nこの対応関係は, [ Arvo 1993] で示唆されているように, 既知であることが伺えます. しかし, このことを一貫して解説した文献を見つけることができなかったため, 自分なりにノートをまとめました.\nそれでは, 空間に漂うホコリに光が当たって散乱する現象を考えることから始めていきます。\n散乱媒質と光 #  いま, 空間を漂うホコリや, それに当たって散乱する光は, 位置 \\(\\bm{x}\\) で 運動量 \\(\\bm{p}\\) で運動する粒子と考えます. 光が当たる対象の物質はホコリに限らず, 酸素など大気を構成する分子や, 水滴などのエアロゾルも考えます. 以降, これらの物質をまとめて散乱媒質, その粒子を散乱体と呼ぶことにします.\nあとは, 媒質へ入射した光の粒子が移動する場所がわかれば, それを全て計算することで, 現実と同じ見た目を再現することが期待できます. しかし, 空間に漂う全ての粒子の運動を計算するのは大変です.\nそこで, それぞれの粒子の運動を考える代わりに, 粒子の集団の運動を考えます.\n気体分子運動論 #  それぞれが力学に基づいて運動する粒子の集団があったとき, その集団の性質を考える体系は 気体分子運動論 として知られています. のちに, 媒質による光の散乱をこの体系に基づいて議論するため, ここで必要な知識をおさらいしておきます.\n密度関数 #  時間 \\(t\\), 位置 \\(\\bm{x}(t)\\), 運動量 \\(\\bm{p}(t)\\) にある粒子の集団を, 密度関数 \\(f(\\bm{x},\\bm{p},t)\\) で表します1.\nそして, 密度関数を運動量体積要素 \\(d\\bm{p}=dp_xdp_ydp_z\\) で積分すれば, 位置 \\(\\bm{x}\\) の粒子数密度   \\[\t\\frac{1}{h^3}\\int f(\\bm{x},\\bm{p},t)d\\bm{p} = n(\\bm{x},t) \\qquad[\\text{m}^{-3}]\\]  が, 粒子数密度 \\(n(\\bm{x},t)\\) を体積要素 \\(d\\bm{x}=dxdydz\\) で積分すれば, 全粒子数  \\[\t\\int n(\\bm{x},t)d\\bm{x} = N \\qquad[\\text{-}],\\]  と得られるとします. ここで, 全粒子数 \\(N\\) は粒子の運動に伴って変化しないとしました2. また, \\(d\\bm{x}d\\bm{p}\\) の単位 \\([\\text{J}^3\\,\\text{s}^3]\\) をキャンセルするため, プランク定数 \\(h\\,[\\text{J}\\,\\text{s}]\\) を使った係数 \\(\\frac{1}{h^3}\\) を掛けました.\nこの密度関数を使い, 媒質の中を光がどう広がっていくかを考えます. 光が媒質の中を進むに従って衝突を繰り返し, その密度分布を変えていくことを表現するために, 密度関数の時間変化を  \\[\t\\frac{df}{dt} = \\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{coll}\\]  と表します. 左辺は \\(f(\\bm{x}(t),\\bm{p}(t),t)\\) を \\(t\\) で全微分することで  \\[\t\\frac{df}{dt} = \\frac{\\partial f}{\\partial t} \u0026#43; \\frac{\\partial f}{\\partial\\bm{x}}\\cdot\\dot{\\bm{x}} \u0026#43; \\frac{\\partial f}{\\partial\\bm{p}}\\cdot\\dot{\\bm{p}}\\]   \\[\t\\dot{\\bm{x}}:=\\frac{d\\bm{x}}{dt},\\; \\dot{\\bm{p}}:=\\frac{d\\bm{p}}{dt}\\]  と与えられます.\n右辺は \\(\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{coll}\\) はこれから考えます. 以降, この項を衝突項と呼びます,\n衝突率 #  まず, 粒子同士の衝突を考えるには, 粒子同士の衝突を考える必要があります. そこで, 単位時間当たりの衝突率 \\(\\eta\\,[\\text{s}^{-1}]\\) を導入して, 粒子の衝突による密度関数の変化を  \\[\t\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{coll} \\sim f\\,\\eta\\]  と見積もることにします.\nそして, 粒子へ空間的な広がりを持たせるために, 散乱断面積 \\(\\sigma\\,[\\text{m}^2]\\) という概念を導入します.\n  Fig. 散乱断面積 \\(\\sigma\\,[\\text{m}^2]\\)\n   これに空間中の粒子密度 \\(n\\,[\\text{m}^{-3}]\\) と, 粒子の相対速度 \\(v\\,[\\text{m}\\,\\text{s}^{-1}]\\) を掛ければ, 粒子同士の衝突率は  \\[\t\\eta = n \\sigma v \\qquad [\\text{s}^{-1}]\\]  と求まります.\n  Fig. 衝突率 \\(\\eta\\)\n   -- 微分散乱断面積 #  次に, 位置 \\(\\bm{x}\\) で \\(\\bm{p}\\) と \\(\\bm{p}_*\\) の粒子が衝突して, \\(\\bm{p}'\\) と \\(\\bm{p}'_*\\) になることを考えます.\n  Fig. \\(\\bm{p},\\,\\bm{p}_* \\rightarrow \\bm{p}',\\,\\bm{p}'_*\\)\n   このとき, 前節で導入した衝突率は方向依存性がないため, 球の形をした粒子同士の衝突しか表現することができません. そこで, 次のように微分散乱断面積 \\(\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|\\) を導入します.\n  Fig. 微分散乱断面積 \\(\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|\\;[\\text{m}^2/\\text{sr}]\\)\n   まず, 方向 \\(\\bm{i}\\) と \\(\\bm{o}\\) を  \\[\t\\bm{o}=\\frac{\\bm{p}}{|\\bm{p}|},\\quad \\bm{i}=\\frac{\\bm{p}\u0026#39;}{|\\bm{p}\u0026#39;|}\\]  とし, それらのなす角を \\(\\theta,\\,\\varphi\\). 立体角を \\(\\bm{\\omega}=\\sin\\theta d\\theta d\\varphi\\) と書きます3.\nそして, 方向 \\(\\bm{\\omega}\\) に垂直な微小断面積 \\(d\\bm{\\omega}\\) を, 微小立体角の関数であることを仮定して,  \\[\t\\sigma = \\int d\\bm{\\sigma} = \\int_{S^2}\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|d\\bm{\\omega} \\qquad[\\text{m}^2\\,\\text{sr}^{-1}]\\]  と, 微分散乱断面積 \\(\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|\\) を導入します.\n衝突項 #  それでは, 衝突項の具体的な表現を与えます.\nまず, 密度関数 \\(f(\\bm{x},\\bm{p},t)\\) が増えるときと減るときに分けて考え, 衝突項を獲得項と損失項の二つで表します.  \\[\t\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{coll} = \\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{gain} - \\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{loss}\\]  密度関数が減るときは, 位置 \\(\\bm{x}\\) で \\(\\bm{p}\\) と \\(\\bm{p}_*\\) の粒子が衝突して, \\(\\bm{p}'\\) と \\(\\bm{p}'_*\\) になる場合です.\n  Fig. \\(\\bm{p},\\,\\bm{p}_* \\rightarrow \\bm{p}',\\,\\bm{p}'_*\\)\n   \\(f(\\bm{p})\\) は, 運動量 \\(\\bm{p}_*\\) を持つ粒子に衝突したぶんだけ減少します. その粒子数は \\(f(\\bm{p}_*)d\\bm{p}_*\\), 相対速度は \\(|\\bm{v}-\\bm{v}_*|\\), 散乱断面積は \\(\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|d\\bm{\\omega}\\) となることから, 衝突率は  \\[\t|\\bm{v}-\\bm{v}_*|\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|f(\\bm{p}_*)d\\bm{p}_*d\\bm{\\omega} \\qquad[\\text{s}^{-1}]\\]  となります. 従って, 損失項は  \\[\t\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{loss} = \\iint|\\bm{v}-\\bm{v}_*|\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|f(\\bm{p})f(\\bm{p}_*)d\\bm{p}_*d\\bm{\\omega}\\]  と得られます.\n密度関数が増えるときは, 減るときと逆に, \\(\\bm{p}'\\) と \\(\\bm{p}'_*\\) の粒子が衝突して \\(\\bm{p}\\) と \\(\\bm{p}_*\\) になる場合を考えます.\n  Fig. \\(\\bm{p}',\\,\\bm{p}'_* \\rightarrow \\bm{p},\\,\\bm{p}_*\\)\n   詳細は参考文献 [ Cercignani 1988; 藤田 1989; Kardar 2007] に譲って省略しますが, 衝突時のエネルギー保存と運動量保存を考慮することで, 損失項は  \\[\t\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{gain} = \\iint|\\bm{v}-\\bm{v}_*|\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|f(\\bm{p}\u0026#39;)f(\\bm{p}\u0026#39;_*)d\\bm{p}_*d\\bm{\\omega}\\]  と得られます.\n上記の損失項と獲得項を使い, 衝突項は  \\[\t\\left(\\frac{\\partial f}{\\partial t}\\right)_\\text{loss} = \\iint|\\bm{v}-\\bm{v}_*|\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right| \\left[f(\\bm{p}\u0026#39;)f(\\bm{p}\u0026#39;_*) - f(\\bm{p})f(\\bm{p}_*)\\right]d\\bm{p}_*d\\bm{\\omega}\\]  となります.\nBoltzmann 方程式 #  以上の結果をまとめると  \\[\\begin{aligned} \u0026amp;\\left(\\frac{\\partial}{\\partial t} \u0026#43; \\dot{\\bm{x}}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \u0026#43; \\dot{\\bm{p}}\\cdot\\frac{\\partial}{\\partial\\bm{p}}\\right)f(\\bm{p})\\\\ \u0026amp;\\qquad = \\iint|\\bm{v}-\\bm{v}_*| \\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|\\left[f(\\bm{p}\u0026#39;)f(\\bm{p}\u0026#39;_*) - f(\\bm{p})f(\\bm{p}_*)\\right]d\\bm{p}_*d\\bm{\\omega} \\end{aligned}\\]  が得られます. これは, Boltzmann 方程式として知られています. 詳しくは, [ Cercignani 1988; 藤田 1989; Kardar 2007] などを参考にしてください.\nこの節のまとめ #  この節では, 粒子の集団を 密度関数 \\(f(\\bm{x},\\bm{p},t)\\), 粒子同士の衝突を 微分散乱断面積 \\(\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}}\\right|\\) で書いたとき, その密度関数が空間を動く様子が Boltzmann 方程式 で与えられることを導きました.\nRadiative Transfer #  光と媒質の Boltzmann 方程式 #  空間中に光と散乱媒質の2成分から成る粒子の集団があったとき, 光に関する Boltzmann 方程式を求めます.\n光の密度関数を \\(f_p(\\bm{x},\\bm{p},t)\\), 媒質の密度関数を \\(f_m(\\bm{x},\\bm{p},t)\\) と書けば, Boltzmann 方程式は  \\[\t\\left( \\frac{\\partial }{\\partial t} \u0026#43; \\dot{\\bm{x}}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \u0026#43; \\dot{\\bm{p}}\\cdot\\frac{\\partial}{\\partial\\bm{p}} \\right)f_p(\\bm{p}) = \\left(\\frac{\\partial f_p}{\\partial t}\\right)_\\text{pm} \u0026#43; \\left(\\frac{\\partial f_p}{\\partial t}\\right)_\\text{pp}\\]   \\[\\begin{aligned} \\left(\\frac{\\partial f_p}{\\partial t}\\right)_\\text{pm} \u0026amp;= \\int |\\bm{v}-\\bm{v}_*| \\left|\\frac{d\\bm{\\sigma}_{pm}}{d\\bm{\\omega}}\\right|\\left[f_p(\\bm{p}\u0026#39;)f_m(\\bm{p}\u0026#39;_*) - f_p(\\bm{p})f_m(\\bm{p}_*)\\right]d\\bm{p}_*d\\bm{\\omega}\\\\ \\left(\\frac{\\partial f_p}{\\partial t}\\right)_\\text{pp} \u0026amp;= \\int |\\bm{v}-\\bm{v}_*| \\left|\\frac{d\\bm{\\sigma}_{pp}}{d\\bm{\\omega}}\\right|\\left[f_p(\\bm{p}\u0026#39;)f_p(\\bm{p}\u0026#39;_*) - f_p(\\bm{p})f_p(\\bm{p}_*)\\right]d\\bm{p}_*d\\bm{\\omega} \\end{aligned}\\]  となります. \\(\\sigma_{pm}\\) は光が媒質へ衝突するときの散乱断面積, \\(\\sigma_{pp}\\) は光が光へ衝突するときの散乱断面積です. また, \\(f(\\bm{x},\\bm{p},t)\\) を \\(f(\\bm{p})\\) と略記しています.\nいま, 光に対して\n 外力を無視する  \\[\t\\dot{\\bm{p}}=0\\]   速度は定数 \\(c\\,[\\text{m}\\,\\text{s}^{-1}]\\) とする  と仮定します.\nそして, 媒質を Lorentz gas [ Lorentz 1905] と同様に考えて,\n 光との衝突による運動量変化は無視できる  \\[\tf_m(\\bm{p}\u0026#39;_*)\\approx f_m(\\bm{p}_*)\\]   光同士の散乱断面積は, 媒質と光の散乱断面積に比べて無視できる  \\[\t\\sigma_{pm} \\gg \\sigma_{pp}\\]   媒質の移動速度は, 光の速度 \\(c\\) に比べて無視できる  \\[\t|\\bm{v}-\\bm{v}_*|\\approx c\\]    と仮定します.\nこれをさきほどの Boltzmann 方程式へ適用すると,  \\[\t\\left(\\frac{\\partial}{\\partial t} \u0026#43; \\dot{\\bm{x}}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \\right)f_p(\\bm{p}) = c n_m \\int \\left|\\frac{d\\bm{\\sigma}_{pm}}{d\\bm{\\omega}}\\right|\\left[f_p(\\bm{p}\u0026#39;) - f_p(\\bm{p})\\right]d\\bm{\\omega}\\]  となります. ここで, 媒質の粒子密度を \\(n_m = \\int f_m(\\bm{p}_*)d\\bm{p}_*\\) と書きました.\nいろいろと仮定を入れて方程式のかたちが変わってきたので, 先に進む前に, いったん記号を整理します.\n放射輝度 #   微分散乱断面積 で導入した方向 \\(\\bm{i}\\) と \\(\\bm{o}\\) を使って, 運動量 \\(\\bm{p}\\) と \\(\\bm{p}'\\) を  \\[\t\\bm{p}=|\\bm{p}|\\bm{o},\\quad \\bm{p}\u0026#39;=|\\bm{p}\u0026#39;|\\bm{i}\\]  と書き直します. これに伴い, 密度関数 \\(f_p(\\bm{x},\\bm{p},t)\\) の引数は \\(f_p(\\bm{x},\\bm{o},|\\bm{p}|,t)\\) となります.\nこれまで, 光は位置 \\(\\bm{x}\\), 運動量 \\(\\bm{p}\\) をもつ粒子として考えてきました. ここで, その最小単位である, 光子について考えます.\n 可視光 は振動数 \\(\\nu\\) が 400 THz から 800 THz 程度の 電磁波 であり, それに対応する 電磁場の量子 は, エネルギー \\(h\\nu\\) をもつ 光子 です. そこで, 光子の運動量と電磁波の振動数が, Einstein - de Broglie の関係式によって\\(|\\bm{p}|=\\frac{h\\nu}{c}\\) と関係していることを考慮して, 密度関数 \\(f_p(\\bm{x},\\bm{o},|\\bm{p}|,t)\\) の引数を \\(f_p(\\bm{x},\\bm{o},\\nu,t)\\) とします.\nさらに, 放射輝度 \\(L(\\bm{x},\\bm{\\omega},\\nu,t)\\) とのあいだに  \\[\tL(\\bm{x},\\bm{\\omega},\\nu,t) = \\frac{2h\\nu^3}{c^2}f_p(\\bm{x},\\bm{\\omega},\\nu,t) \\quad[\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\text{Hz}^{-1}]\\]  という関係がある [ 藤田 1990] ことから, 以降は光の密度関数 \\(f_p\\) の代わりに放射輝度 \\(L\\) を用いることにします.\n位相関数 #  微分散乱断面積を散乱断面積 \\(\\sigma\\) で規格化したものを, 位相関数 \\(p(\\bm{i},\\bm{o})\\) と定義します.  \\[\tp(\\bm{i},\\bm{o}) := \\frac{1}{\\sigma}\\left|\\frac{d\\bm{\\sigma}}{d\\bm{\\omega}_i}\\right| \\quad[\\text{sr}^{-1}]\\]  微分散乱断面積 の定義から, 位相関数は 1 に規格化されています.  \\[\t\\int p(\\bm{i},\\bm{o}) d\\bm{\\omega}_i = 1\\]  散乱係数 #  粒子数密度 \\(n\\,[\\text{m}^{-3}]\\) と散乱断面積 \\(\\sigma\\,[\\text{m}^2]\\) を使って, 散乱係数 \\(\\mu\\) を  \\[\t\\mu:=n\\sigma \\qquad[\\text{m}^{-1}]\\]  と定義しておきます.\n光と媒質の Boltzmann 方程式 #  さいごに, 積分 \\(\\int d\\bm{\\omega}\\) が, 方向 \\(\\bm{o}\\) を軸として, 方向 \\(\\bm{i}\\) をぐるっと回すことを表すことを強調するために, \\(\\bm{o}\\) と \\(\\bm{i}\\) のなす角を \\(\\theta_i,\\,\\varphi_i\\), 微小立体角を \\(d\\bm{\\omega}_i = \\sin\\theta_id\\theta_id\\varphi_i\\) と書き直しておきます.\n以上で導入した 放射輝度 と 位相関数 を使うと, さきほどの Boltzmann 方程式は,  \\[\t\\frac{\\partial L(\\bm{o})}{\\partial t} \u0026#43; c\\frac{\\partial L(\\bm{o})}{\\partial\\bm{x}}\\cdot\\bm{o} = c n_m \\sigma_{pm} \\int p(\\bm{i},\\bm{o}) L(\\bm{i}) d\\bm{\\omega}_i - c n_m \\sigma_{pm} L(\\bm{o})\\]  となります. 両辺を整理し, 散乱係数 を使うと  \\[\t\\left(\\frac{1}{c}\\frac{\\partial}{\\partial t} \u0026#43; \\bm{o}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \u0026#43; \\mu_s\\right)L(\\bm{o}) = \\mu_s\\int p(\\bm{i},\\bm{o}) L(\\bm{i}) d\\bm{\\omega}_i\\]  となります. ここで, 放射輝度 \\(L(\\bm{x},\\bm{\\omega}, \\nu, t)\\) を \\(L(\\bm{\\omega})\\) と略記しました.\nこれで, 媒質へ衝突しながら進む, 光の密度分布を表現する方程式が得られました.\nRadiative Transfer #  局所熱平衡 #  Chandrasekhar は, 恒星大気内で局所的に熱平衡にある領域に対して, 媒質が吸収した光 \\(\\mu_a(\\bm{x},\\nu) L(\\bm{x},\\bm{o},\\nu,t)\\) は黒体輻射 \\(B(\\nu,T)\\) で放出されるとしました [ Chandrasekhar 1960].  \\[\t\\int \\mu_a(\\bm{x},\\nu) L(\\bm{x},\\bm{o},\\nu,t) d\\nu = \\int \\mu_a(\\bm{x},\\nu) B(\\nu, T) d\\nu\\]  ここで, 媒質が光を吸収することを表現するために, 散乱係数 \\(\\mu_s\\) に加えて吸収係数 \\(\\mu_a\\) を導入しました.\nRadiative Transfer 方程式 #   局所熱平衡 を考慮して, 媒質による光の吸収 \\(\\mu_aL\\) と, 黒体輻射による放出 \\(\\mu_aB\\) を先ほどの Boltzmann 方程式へ 導入すると,  \\[\t\\left(\\frac{1}{c}\\frac{\\partial}{\\partial t} \u0026#43; \\bm{o}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \u0026#43; \\mu_t\\right)L(\\bm{o}) = \\mu_aB \u0026#43; \\mu_s\\int p(\\bm{i},\\bm{o}) L(\\bm{i}) d\\bm{\\omega}_i\\]  となります. ここで全消散係数 \\(\\mu_t = \\mu_a + \\mu_s\\) を導入しました.\nこの式は Radiative Transfer 方程式と呼ばれています [ Chandrasekhar 1960; Arvo 1993].\nこの節のまとめ #  この節では, 光と散乱媒質の Boltzmann 方程式 へ, 光が媒質に比べてずっと軽くて速い仮定を行うとともに, 局所熱平衡 を取り入れることで, Radiative Transfer 方程式 を導きました.\nRendering 方程式 #  Volume Rendering 方程式 #   Radiative Transfer方程式 に対して, 人間の感覚に合わせた近似や調整を行います.\nまず, 人間にとって光は一瞬で伝わるものと考え, 放射輝度の時間依存性を落として \\(L_\\text{re}(\\bm{x},\\bm{\\omega},\\nu,t)\\rightarrow L_\\text{re}(\\bm{x},\\bm{\\omega},\\nu)\\) とします. そして, 媒質が吸収した光の再放射は黒体輻射に限らないとして, 黒体輻射 \\(B(\\nu,T)\\) を一般の再放射 \\(L_\\text{re}(\\bm{x},\\bm{\\omega},\\nu)\\) で書き換えます.\nこれらを Radiative Transfer 方程式へ適用することで  \\[\t\\left(\\bm{o}\\cdot\\frac{\\partial}{\\partial\\bm{x}} \u0026#43; \\mu_t\\right)L(\\bm{o}) = \\mu_aL_\\text{re}(\\bm{o}) \u0026#43; \\mu_s\\int_{S^2} p(\\bm{i},\\bm{o}) L(\\bm{i}) d\\bm{\\omega}_i\\]  が得られます. ここで, 放射輝度 \\(L(\\bm{x},\\bm{\\omega},\\nu)\\) を \\(L(\\bm{\\omega})\\) とするなど, 方向成分以外の引数を略して書きました. この記事では, この式を Volume Rendering 方程式と呼びます.\nRendering 方程式 #  Volume Rendering 方程式は, 位置 \\(\\bm{x}\\) に関する微分方程式なので, これを解くには空間的な境界条件が必要になります.\nそこで境界条件として, Volume Rendering 方程式から \\(\\bm{o}\\cdot\\frac{\\partial L}{\\partial\\bm{x}}\\) を落とすことで, 衝突率 100% の表面を用意します.  \\[\t\\mu_tL(\\bm{o}) = \\mu_aL_\\text{re}(\\bm{o}) \u0026#43; \\mu_s\\int_{H^\u0026#43;} f_r(\\bm{i},\\bm{o})(\\bm{i}\\cdot\\bm{n}) L(\\bm{i}) d\\bm{\\omega}_i\\]  なお, 表面の法線を \\(\\bm{n}\\) とし, \\(\\bm{i}\\cdot\\bm{n}\u0026gt;0\\) である半球面を \\(H^+\\) と書きました. また位相関数 \\(p(\\bm{i},\\bm{o})\\) の代わりに導入した \\(f_r(\\bm{i},\\bm{o})(\\bm{i}\\cdot\\bm{n})\\) については, すぐ後で説明します.\nここで反射率 \\(k_r:=\\frac{\\mu_s}{\\mu_t}\\), 吸収率 \\(k_a:=\\frac{\\mu_a}{\\mu_t}\\) という量を導入すれば,  \\[\tL(\\bm{o}) = k_aL_\\text{re}(\\bm{o}) \u0026#43; k_r\\int_{H^\u0026#43;} f_r(\\bm{i},\\bm{o})(\\bm{i}\\cdot\\bm{n}) L(\\bm{i}) d\\bm{\\omega}_i\\]  となります. なお, 散乱係数のあいだの関係 \\(\\mu_t=\\mu_a+\\mu_s\\) から, 反射率と吸収率のあいだには \\(k_r + k_s = 1\\) という関係があります.\n上式の \\(k_aL_\\text{re}(\\bm{o})\\) を自己発光 \\(L_\\epsilon\\) に差し替えると, Kajiya の Rendering 方程式 [ Kajiya 1986] と同じものが得られることから, この記事では上式を Rendering 方程式と呼びます.\nBidirectional Reflectance Distribution Function (BRDF) #    Fig. \\(d\\bm{\\sigma}_r\\) と \\(d\\bm{\\omega}_i\\)\n   法線 \\(\\bm{n}\\) を持つ表面の微小面積を \\(d\\bm{\\sigma}_n\\) としたとき, それを方向 \\(\\bm{i}\\) へ射影した面積は \\((\\bm{i}\\cdot\\bm{n})d\\bm{\\sigma}_n\\) です. これを表面の上半球面 \\(H_n^+\\) で集めたものを, 散乱断面積 \\(\\sigma_r\\) とします.  \\[\t\\sigma_r = \\int_{H_n^\u0026#43;}(\\bm{i}\\cdot\\bm{n})d\\bm{\\sigma}_n \\qquad[\\text{m}^2]\\]  そして, 微分散乱断面積 で行った議論と同様にして, 単位立体角当たりの面積分布 \\(\\left|\\frac{d\\bm{\\sigma}_n}{d\\bm{\\omega}_i}\\right|\\) を導入します.  \\[\t\\sigma_r = \\int_{H_n^\u0026#43;}\\left|\\frac{d\\bm{\\sigma}_n}{d\\bm{\\omega}_i}\\right|(\\bm{i}\\cdot\\bm{n})d\\bm{\\omega}_i \\qquad[\\text{m}^2]\\]  このとき, 面積分布 \\(\\left|\\frac{d\\bm{\\sigma}_n}{d\\bm{\\omega}_i}\\right|\\) を散乱断面積 \\(\\sigma_r\\) で規格化した量 \\(f(\\bm{i},\\bm{o})\\) を BRDF と呼びます.  \\[\tf(\\bm{i},\\bm{o}):=\\frac{1}{\\sigma_r}\\left|\\frac{d\\bm{\\sigma}_r}{d\\bm{\\omega}_i}\\right| \\qquad[\\text{sr}^{-1}]\\]  なお, 方向 \\(\\bm{o}\\) に対して法線 \\(\\bm{n}\\) が傾いている場合, 散乱断面積は \\((\\bm{o}\\cdot\\bm{n})\\sigma_r\\) となります.\n  Fig. \\((\\bm{o}\\cdot\\bm{n})\\sigma_r\\)\n   Microfacet モデル #  この節では, 粗い面を表現する BRDF である Microfacet BRDF を作ります. 作り方は [ Walter et al. 2007; Heitz 2014] と同様ですが, 微分散乱断面積に焦点を当てて話を進めます.\nこれまで考えていた, 法線 \\(\\bm{n}\\) をもつ表面を macrosurface と呼び, その上の微細なデコボコを microsurface と呼びます そして, microsurface は完全鏡面で出来ているとします.\n  Fig. Macrosurface 上の法線 \\(\\bm{n}\\) と, microsurface 上の法線 \\(\\bm{m}\\)\n   ハーフベクトル #  方向 \\(\\bm{i}\\) と方向 \\(\\bm{o}\\) を2分割する方向を, ハーフベクトル \\(\\bm{h}\\) と呼びます.  \\[\t\\bm{h}:=\\frac{\\bm{i}\u0026#43;\\bm{o}}{|\\bm{i}\u0026#43;\\bm{o}|}\\]  完全鏡面の上では, その法線 \\(\\bm{m}\\) とハーフベクトル \\(\\bm{h}\\) は一致します.\n  Fig. ハーフベクトル\n   そのため以後は, microsurface 上の法線を \\(\\bm{m}\\) の代わりに \\(\\bm{h}\\) と表記します.\n法線分布関数 #    Fig. \\(d\\bm{\\sigma}_h,\\,d\\bm{\\omega}_h\\)\n    BRDF と同様にして, microsurface 上の微小面積 \\(d\\bm{\\sigma}_h\\) を考えます. これを方向 \\(\\bm{i}\\) へ射影した面積 \\((\\bm{i}\\cdot\\bm{h})d\\bm{\\sigma}_h\\) を microsurface 上の半球面 \\(H_h^+\\) で集めたものを, 散乱断面積 \\(\\sigma_r\\) とします.\n \\[\t\\sigma_r = \\int_{H_h^\u0026#43;}(\\bm{i}\\cdot\\bm{h})d\\bm{\\sigma}_h \\qquad[\\text{m}^2]\\]  続いて, ハーフベクトルを使った微小立体角を \\(d\\bm{\\omega}_h:=\\sin\\theta_hd\\theta_hd\\varphi_h\\) と書き, 単位立体角当たりの面積分布 \\(\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|\\) を  \\[\t\\sigma_r = \\int_{H_h^\u0026#43;}\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|(\\bm{i}\\cdot\\bm{h})d\\bm{\\omega}_h \\qquad[\\text{m}^2]\\]  と導入します.\nこのとき, 面積分布 \\(\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|\\) を散乱断面積 \\(\\sigma_r\\) で規格化した量 \\(D(\\bm{h})\\) を法線分布関数と呼びます.  \\[\tD(\\bm{h}):=\\frac{1}{\\sigma_r}\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| \\qquad[\\text{sr}^{-1}]\\]  ところで, BRDF では, 方向 \\(\\bm{o}\\) に対して macrosurface が傾いている場合に, 散乱断面積が \\((\\bm{o}\\cdot\\bm{n})\\sigma_r\\) となるとしました.\n  Fig. \\((\\bm{o}\\cdot\\bm{n})\\sigma_r\\)\n   しかし, いまは明示的にデコボコした microsurface を考えているため, 隣接した microsurface からの遮蔽を考慮することが必要です. Masking 関数 #  Microsurface の可視面積を議論するため, \\(\\bm{i}\\) か \\(\\bm{o}\\) のいずれかを表す方向を \\(\\bm{\\omega}\\) と書きます.\n  Fig. Masking 関数 \\(G_1\\)\n   方向 \\(\\bm{\\omega}\\) へ射影した微小面積 \\((\\bm{i}\\cdot\\bm{h})d\\bm{\\sigma}_h\\) を 集めるとき, Microsurfaceの表側がどれくらいあるかが記述された関数 \\(G_1\\) があったとして,  \\[\\begin{aligned} (\\bm{\\omega}\\cdot\\bm{n})\\sigma_r \u0026amp;= \\int_{H_h^\u0026#43;}G_1(\\bm{\\omega},\\bm{h}) (\\bm{\\omega}\\cdot\\bm{h})d\\bm{\\sigma}_h\\\\ \u0026amp;= \\int_{H_h^\u0026#43;}G_1(\\bm{\\omega},\\bm{h}) \\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|(\\bm{\\omega}\\cdot\\bm{h})d\\bm{\\omega}_h \\end{aligned}\\]  と求まるとします. この関数 \\(G_1\\) は, Smith masking 関数として知られています. 詳細は [ Smith 1967; Walter et al. 2007; Heitz 2014] を参照してください4.\nShadowing-Masking 関数 #  隣接する microsurface のによる遮蔽は, 方向 \\(\\bm{i}\\) と \\(\\bm{o}\\) の両者に対して考える必要があります. ここでも詳細は [ Heitz 2014] に任せて, そのような遮蔽が考慮された関数 \\(G_2\\) があるとします.\nこの場合, 方向 \\(\\bm{i}\\) から入射した光が, microsurface 上の 1 回反射で方向 \\(\\bm{o}\\) へ向かわない領域が生じます.\n  Fig. Shadowing-masking 関数の可視範囲\n   そこで, 両者の遮蔽を考慮した場合の可視部分を \\(\\sigma_r^\\text{single}\\), それ以外を \\(\\sigma_r^\\text{multi}\\) と呼び分けておきます.  \\[\t\\sigma_r = \\sigma_r^\\text{single} \u0026#43; \\sigma_r^\\text{multi}\\]  そうすると, \\(\\sigma_r^\\text{single}\\) は Shadowing-masking 関数 \\(G_2\\) を使って  \\[\t(\\bm{o}\\cdot\\bm{n})\\sigma_r^\\text{single} = \\int_{H_h^\u0026#43;}G_2(\\bm{i},\\bm{o},\\bm{h}) \\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|(\\bm{i}\\cdot\\bm{h})d\\bm{\\omega}_h\\]  と書けます.\nFresnel の式 #  光が屈折率の異なる媒質同士の境界を通過するとき, 反射と屈折が起きます.\n  Fig. 入射光 \\(\\bm{i}\\) と 反射光 \\(\\bm{o}\\), 屈折光 \\(\\bm{t}\\)\n   反射と屈折がどのように起こるかは Fresnel の式 によって記述されます. その詳細や 近似式 は参考文献 [ Born and Wolf 1999] [ Schlick 1994] を参照してください.\nこの記事では, 入射光が反射光と屈折光に分かれることを, 全断面積 \\(\\sigma_t\\), 反射断面積 \\(\\sigma_r\\), 吸収断面積 \\(\\sigma_a\\) を使って  \\[\t\\sigma_t = \\sigma_r \u0026#43; \\sigma_a \\qquad[\\text{m}^2]\\]  と使って表すことにします.\nそして, その反射成分の割合を表す Fresnel 反射率を \\(F(\\bm{i},\\bm{h})\\) と書きます.\nMicrofacet BRDF #  以上の結果を使って, Microfacet BRDF を導きます.\n Shadowing-Masking 関数と Fresnel の式 で, 入射光が単一反射と屈折, そして多重反射に分かれることを  \\[\t\\sigma_t = \\sigma_r^{\\text{single}} \u0026#43; \\sigma_r^{\\text{multi}} \u0026#43; \\sigma_a\\]  と表現しました. そして, 単一反射は  \\[\t\\sigma_r^{\\text{single}} = \\int_{H^\u0026#43;_h}\\frac{F(\\bm{i},\\bm{h})G_2(\\bm{i},\\bm{o},\\bm{h})}{(\\bm{o}\\cdot\\bm{n})} \\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|(\\bm{i}\\cdot\\bm{h})d\\bm{\\omega}_h\\]  と求まります.\n\\(d\\bm{\\omega}_h=\\frac{1}{4(\\bm{i}\\cdot\\bm{h})}d\\bm{\\omega}_i\\) を使って, \\(d\\bm{\\omega}_h\\) を \\(d\\bm{\\omega}_i\\) へ変数変換すれば  \\[\t\\sigma_r^\\text{single} = \\int_{H^\u0026#43;_n}\\frac{F(\\bm{i},\\bm{h})G_2(\\bm{i},\\bm{o},\\bm{h})}{4(\\bm{o}\\cdot\\bm{n})(\\bm{i}\\cdot\\bm{n})} \\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|(\\bm{i}\\cdot\\bm{n})d\\bm{\\omega}_i\\]  となり, これを BRDF の微分散乱断面積  \\[\t\\sigma_r = \\int_{H_n^\u0026#43;}\\left|\\frac{d\\bm{\\sigma}_n}{d\\bm{\\omega}_i}\\right|(\\bm{i}\\cdot\\bm{n})d\\bm{\\omega}_i\\]  と見比べると, 単一反射について  \\[\t\\left|\\frac{d\\bm{\\sigma}_n}{d\\bm{\\omega}_i}\\right| = \\frac{F(\\bm{i},\\bm{h})G_2(\\bm{i},\\bm{o},\\bm{h})}{4(\\bm{o}\\cdot\\bm{n})(\\bm{i}\\cdot\\bm{n})} \\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|\\]  という関係が得られます.\nこれにより, 単一反射を表す Microfacet モデルの BRDF は [ Walter et al. 2007; Heitz 2014] と同様に  \\[\tf_r(\\bm{i},\\bm{o}) = \\frac{F(\\bm{i},\\bm{h})G_2(\\bm{i},\\bm{o},\\bm{h})D(\\bm{h})}{4(\\bm{o}\\cdot\\bm{n})(\\bm{i}\\cdot\\bm{n})}\\]  と求まりました.\nこの節のまとめ #  [ Arvo 1993] と同様に, Radiative Transfer 方程式 で時間変化を無視できるとして Volume Rendering 方程式 を導き, その境界条件として Rendering 方程式 を考えました.\nそして [ Walter et al. 2007; Heitz 2014] と同様にして Microsurface BRDF を導きました.\nGGX 法線分布関数 #  前節で Microsurface BRDF を導きました. BRDF は微分散乱断面積で書いたので, 散乱理論の手法を応用できます.\nこの節では, その一例として 衝突パラメータ を用いた GGX 法線分布関数 [ Trowbridge and Reitz. 1975; Walter et al. 2007] の導出を行います.\n衝突パラメータ #  はじめに, 衝突パラメータを用いた微分散乱断面積の表現方法をおさらいします [ Landau and Lifshitz 1976; 砂川 1977].\nいま, microfacet が回転対称な形状をしているとして, その中心軸からの距離を衝突パラメータ \\(b\\) と呼びます.\n  Fig. 衝突パラメータ― \\(b\\)\n   このとき, 微小散乱断面積 \\(d\\bm{\\sigma}_r\\) と \\(b\\) の関係は.  \\[\td\\bm{\\sigma}_r = bdbd\\varphi_h\\]  となります.\nここで衝突パラメータ \\(b\\) が \\(\\theta_h\\) の関数であるとすれば,  \\[\td\\bm{\\sigma}_r = \\left|\\frac{db}{d\\sigma_h}\\right|d\\theta_hd\\varphi_h = \\frac{1}{\\sin\\theta_h}\\left|\\frac{db}{d\\theta_h}\\right|d\\bm{\\omega}_h\\]  と書き換えることができます. 最後の等号で, \\(d\\bm{\\omega}_h=\\sin\\theta_hd\\theta_hd\\varphi_h\\) を使いました.\n従って, 衝突パラメータ \\(b\\) を使って微分散乱断面積を  \\[\t\\left|\\frac{d\\bm{\\sigma}_r}{d\\bm{\\omega}_h}\\right| = \\frac{1}{\\sin\\theta_h}\\left|\\frac{db}{d\\theta_h}\\right|\\]  と書くことができます.\n衝突パラメータによる法線分布関数の表現 #  前節の 衝突パラメータ を使って, 法線分布関数 を表現します.\n  Fig. \\(d\\bm{\\sigma}_r = \\cos\\theta_h d\\bm{\\sigma_h}\\)\n   微小散乱断面積 \\(d\\bm{\\sigma}_r\\) と microfacet 上の微小面積 \\(d\\bm{\\sigma}_h\\) のあいだの関係,  \\[\td\\bm{\\sigma}_r = \\cos\\theta_h d\\bm{\\sigma}_h\\]  を, 前節で求めた微分散乱断面積へ用いると, 単位立体角当たりの面積分布が  \\[\t\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| = \\frac{1}{\\cos\\theta_h}\\frac{1}{\\sin\\theta_h}\\left|\\frac{db}{d\\theta_h}\\right|\\]  と求まります.\n 法線分布関数の定義は,  \\[\tD(\\bm{h}):=\\frac{1}{\\sigma_r}\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| \\qquad[\\text{sr}^{-1}]\\]  としたので, 次は衝突パラメータ \\(b\\) で具体的な形状を表現することが必要です.\nGGX 法線分布関数の導出 #    Fig. \\(\\frac{dz}{db} = \\tan\\theta_h\\)\n   いま, microfacet の形状が \\(z(b)\\) なる関数で書けて, ハーフベクトルと  \\[\t\\frac{dz}{db} = \\tan\\theta_h\\]  という関係にあるとします[ Trowbridge and Reitz. 1975].\n回転楕円体 #  \\(z(b)\\) が表す形状として, [ Trowbridge and Reitz. 1975] と同様に, 回転楕円体 を考えます.\n長半径が \\(1\\), 短半径が \\(\\alpha\\) の回転楕円体は  \\[\tx^2 \u0026#43; y^2 \u0026#43; \\frac{z^2}{\\alpha^2} = 1\\]  となります.\nいま  \\[\tz = \\alpha\\sqrt{1-x^2-y^2}\\]  と書き直して, 衝突パラメータ \\(b\\) を使って  \\[\tb^2 = x^2 \u0026#43; y^2\\]  とすれば,  \\[\tz(b) = \\alpha\\sqrt{1-b^2}\\]  と書き直せます.\nGGXモデルの導出 #  \\(z(b)\\) と \\(\\theta_h\\) の関係 \\(\\frac{dz}{db} = \\tan\\theta_h\\) を 回転楕円体へ適用すれば, 衝突パラメータ \\(b\\) が \\(\\theta_h\\) の関数として  \\[\tb^2 = \\frac{\\tan^2\\theta_h}{\\alpha^2 \u0026#43; \\tan\\theta_h}\\]  と求まります.\nこれを使い, 単位立体角当たりの面積分布を求めると  \\[\t\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| = \\frac{1}{\\cos\\theta_h}\\frac{1}{\\sin\\theta_h}\\left|\\frac{db}{d\\theta_h}\\right| = \\frac{\\alpha^2}{\\cos^4\\theta_h(\\alpha\u0026#43;\\tan^2\\theta_h)^2}\\]  となります.\n従って散乱断面積は  \\[\t\\sigma_r =\\int_{H_h^\u0026#43;}\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right|\\cos\\theta_hd\\bm{\\omega}_h = \\pi\\]  となり, 法線分布関数は  \\[\t\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| = \\frac{1}{\\sigma}\\left|\\frac{d\\bm{\\sigma}_h}{d\\bm{\\omega}_h}\\right| = \\frac{\\alpha^2}{\\cos^4\\theta_h(\\alpha\u0026#43;\\tan^2\\theta_h)^2}\\]  と求まります.\n以上で GGX 法線分布関数 [ Trowbridge and Reitz. 1975; Walter et al. 2007] が求まりました.\nこの節のまとめ #  この節では, はじめに 法線分布関数 と 衝突パラメータ の関係を作りました.\nそして, 回転楕円体 を衝突パラメータで表現することで, GGX 法線分布関数 を求めました.\nまとめ #  この記事では, まず, 主に [ Cercignani 1988] を参考にして Boltzmann 方程式 から Radiative Transfer 方程式 を導きました.\nそれから [ Arvo 1993] を参考に Volume Rendering 方程式 と Rendering 方程式 を導き, そして主に [ Heitz 2014] を参考にして Microface BRDF を導きました.\nこの際, 光と媒質の衝突部分を一貫して 微分散乱断面積 を用いて記述することで, 何らかの幾何形状から Microfacet BRDF を求められるようにしました.\n最後に, 散乱理論 [ 砂川 1977] で知られている 衝突パラメータ を使って, 回転楕円体 から GGX 法線分布関数 を求めました.\n参考文献 #  Lorentz, H. A. 1905. The motion of electrons in metallic bodies i. In KNAW, proceedings. Vol. 7, pp. 438-453. #  Chandrasekhar, S. 1960. Radiative transfer. Dover Publications Inc. #  Smith, B. G. 1967. Geometrical shadowing of a random rough surface. IEEE Trans. on Antennas and Propagation, pp. 668–671. #  Trowbridge, T. S. and Reitz, K. P. 1975. Average irregularity representation of a rough surface for ray reflection. J. Opt. Soc. Am., 65(5):531–536. #  Landau, L. D. and Lifshitz, E. M. 1976. Mechanics. Vol. 1 (3rd ed.). Butterworth-Heinemann. #  砂川, 重信. 1977. 散乱の量子論. 岩波書店. #  Cook, R. L. and Torrance, K. E. 1982. A reﬂectance model for computer graphics. ACM Trans. Graph., 1(1):7–24. #  Kajiya, J. T. 1986. The rendering equation. SIGGRAPH Comput. Graph., 20(4):143–150. #  Cercignani, C. 1988. The Boltzmann Equation and Its Applications. Springer-Verlaq. #  藤田, 重次. 原, 啓明, et al. 共訳. 1989. 統計熱物理学. 裳華房. #  藤田, 重次. 原, 啓明, et al. 共訳. 1990. 量子統計物理学. 裳華房. #  Arvo, J. 1993. Transfer equations in global illumination. SIGGRAPH’93 Course Notes. #  Schlick, C. 1994. An inexpensive BRDF model for physically‐based rendering. In Computer graphics forum, vol. 13, no. 3, pp. 233-246. #  Born, M and Wolf, E. 1999. Principles of Optics (7th ed.). Cambridge University Press. #  Kardar, M. 2007. Statistical Physics of Particles. Cambridge University Press. #  Walter, B., et al. 2007. Microfacet Models for Refraction through Rough Surfaces. In Proceedings of the 18th Eurographics Conference on Rendering Techniques, EGSR’07, pp. 195–206. #  Heitz, E. 2014. Understanding the masking-shadowing function in microfacet-based BRDFs. Journal of Computer Graphics Techniques (JCGT), 3(2):48–107 #    これは, 相空間での1体の分布関数です. しかし分布関数という名前はこの記事内で多数登場するため, 密度関数と言い換えました. \u0026#x21a9;\u0026#xfe0e;\n このことは, Liouvilleの定理 の帰結として導かれます. \u0026#x21a9;\u0026#xfe0e;\n 角度をこのようにあらわすのは, 後の話と整合性をとるためです. \u0026#x21a9;\u0026#xfe0e;\n Masking 関数は, Smith masking 関数のほかに V-cavity などがあります [ Heitz 2014]. この記事では, microsurface に明示的な幾何形状を想定しているため, 法線分布関数から一意に求まる Smith masking 関数のみを紹介しました. \u0026#x21a9;\u0026#xfe0e;\n   "});index.add({'id':6,'href':'/posts/20201021_setting_up_this_site_with_hugo/','title':"Setting up this site with hugo",'section':"Blog",'content':"このウェブサイトは、 https://themes.gohugo.io/theme/hugo-book/ を元に作った。 そのときの備忘録をこの記事に残しておく。\nインストール #   https://github.com/spf13/hugo/releases から実行ファイルを取得  手元の環境は Windows 10 64bit なので、hugo_0.76.5_Windows-64bit を選択   hugo.exe を適当なディレクトリに置き、パスを通す  サイトの作成 #   サイトを作る hugo new site [サイト名]  作成したサイトのディレクトリで git init して、そこを Git のリポジトリにする  テーマの適用 #   https://themes.gohugo.io/hugo-book/ を適用する git submodule add https://github.com/alex-shpak/hugo-book themes/book  https://github.com/alex-shpak/hugo-book にある説明を見て記事を作成  サイトのプレビューと生成 #   プレビュー hugo server  public ディレクトリにサイトを生成 hugo   生成されたサイトを GitHub Pages として公開 #   GitHub Pages用のリポジトリを作成  GitHub へアクセスし、[ユーザー名].github.io という名前のリポジトリを公開設定で作成   submodule として, public ディレクトリを 1. で作成したリポジトリに割り当てる git submodule add -b main https://github.com/[ユーザー名]/[ユーザー名].github.io public  public ディレクトリへ移動し, その中身を git push git push origin main  https://[ユーザー名].github.io/ に記事が公開される  "});})();